// checker.v
module checker;
  // simple counters for stats (optional)
  integer pass_count = 0;
  integer fail_count = 0;

  // Reference model: implement priority reset > load > ce > flag
  function [3:0] ref_model(
    input [3:0] prev_q,
    input [3:0] din,
    input       rst,
    input       load,
    input       ce,
    input       flag    // 1 => up, 0 => down
  );
    reg [4:0] temp; // one extra bit for intermediate
    begin
      if (rst) begin
        ref_model = 4'b0000;
      end else if (load) begin
        // assume din is decimal 0..9
        ref_model = din % 10; // guard, though driver should supply 0..9
      end else if (ce) begin
        if (flag) begin
          // count up decimal 0..9
          if (prev_q == 4'd9)
            ref_model = 4'd0;
          else
            ref_model = prev_q + 1;
        end else begin
          // count down decimal
          if (prev_q == 4'd0)
            ref_model = 4'd9;
          else
            ref_model = prev_q - 1;
        end
      end else begin
        // hold
        ref_model = prev_q;
      end
    end
  endfunction

  task compare(
    input [3:0] expected,
    input [3:0] actual,
    input [3:0] din_s,
    input       rst_s,
    input       load_s,
    input       ce_s,
    input       flag_s
  );
    begin
      if (expected !== actual) begin
        fail_count = fail_count + 1;
        $display("CHECKER FAIL @%0t | rst=%b load=%b ce=%b flag=%b din=%0d | expected=%0d actual=%0d",$time,rst_s,load_s,ce_s,flag_s,din_s,expected,actual);
      end else begin
        pass_count = pass_count + 1;
        $display("CHECKER PASS @%0t | rst=%b load=%b ce=%b flag=%b din=%0d | q=%0d",$time,rst_s,load_s,ce_s,flag_s,din_s,actual);
      end
    end
  endtask

  task report_summary;
    begin
      $display("CHECKER SUMMARY: PASS=%0d FAIL=%0d", pass_count, fail_count);
    end
  endtask

endmodule
