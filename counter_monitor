// monitor.v
module monitor(
  input  wire clk,
  input  wire [3:0] q,
  input  wire reset,
  input  wire load,
  input  wire ce,
  input  wire flag,
  input  wire [3:0] din,
  output reg  [3:0] captured_q,
  output reg  [3:0] captured_din,
  output reg         captured_reset,
  output reg         captured_load,
  output reg         captured_ce,
  output reg         captured_flag,
  output reg         xtn_done     // toggled to notify
);

task init_monitor;
  begin
    captured_q     = 4'b0000;
    captured_din   = 4'b0000;
    captured_reset = 1'b0;
    captured_load  = 1'b0;
    captured_ce    = 1'b0;
    captured_flag  = 1'b1;
    xtn_done       = 1'b0;
  end
endtask

task capture_at_negedge;
  begin
    @(negedge clk);
    captured_q     = q;
    captured_din   = din;
    captured_reset = reset;
    captured_load  = load;
    captured_ce    = ce;
    captured_flag  = flag;
    $display("MONITOR @%0t | rst=%b load=%b ce=%b flag=%b din=%0d q=%0d",$time,captured_reset,captured_load,captured_ce,captured_flag,captured_din,captured_q);
    xtn_done = ~xtn_done; // toggle to notify
  end
endtask

task capture_at_posedge;
  begin
    @(posedge clk);
    captured_q     = q;
    captured_din   = din;
    captured_reset = reset;
    captured_load  = load;
    captured_ce    = ce;
    captured_flag  = flag;
    $display("MONITOR (pos) @%0t | rst=%b load=%b ce=%b flag=%b din=%0d q=%0d",$time,captured_reset,captured_load,captured_ce,captured_flag,captured_din,captured_q);
    xtn_done = ~xtn_done;
  end
endtask

function [3:0] read_q_sample;
  begin
    read_q_sample = captured_q;
  end
endfunction

endmodule
